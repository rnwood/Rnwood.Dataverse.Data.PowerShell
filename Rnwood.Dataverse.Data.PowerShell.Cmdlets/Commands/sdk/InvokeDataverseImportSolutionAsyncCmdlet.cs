// <auto-generated>
//     This code was generated by GenerateRequestCmdlets.ps1 (version 1.0.0) on 2025-10-09T12:32:09.6938618+00:00.
//     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
// </auto-generated>

#pragma warning disable CS1591 // Missing XML comment for publicly visible type or member

using System;
using System.Text;
using System.Management.Automation;
using Microsoft.Xrm.Sdk;
using Microsoft.Xrm.Sdk.Messages;
using Microsoft.Crm.Sdk.Messages;
using Microsoft.PowerPlatform.Dataverse.Client;
using Rnwood.Dataverse.Data.PowerShell.Commands;
using System.IO;

namespace Rnwood.Dataverse.Data.PowerShell.Commands.Sdk
{
    /// <summary>
    /// Contains the data that is needed to import a solution using an asynchronous job.
    /// </summary>
    [System.CodeDom.Compiler.GeneratedCode("GenerateRequestCmdlets.ps1", "1.0.0")]
    [System.Diagnostics.DebuggerNonUserCode]
    [System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
    [Cmdlet("Invoke", "DataverseImportSolutionAsync", SupportsShouldProcess = true, ConfirmImpact = ConfirmImpact.Medium, DefaultParameterSetName = "Default")]
    public class InvokeDataverseImportSolutionAsyncCmdlet : OrganizationServiceCmdlet
    {

        

        

                /// <summary>
        /// Gets or sets whether any unmanaged customizations that have been applied over existing managed solution components should be overwritten. Required.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets whether any unmanaged customizations that have been applied over existing managed solution components should be overwritten. Required.")]
        public System.Boolean OverwriteUnmanagedCustomizations { get; set; }

        /// <summary>
        /// Gets or sets whether any processes (workflows) included in the solution should be activated after they are imported. Required.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets whether any processes (workflows) included in the solution should be activated after they are imported. Required.")]
        public System.Boolean PublishWorkflows { get; set; }

        /// <summary>
        /// Gets or sets the compressed solutions file to import. Required.
        /// </summary>

        [Parameter(ParameterSetName = "Default", HelpMessage = "Gets or sets the compressed solutions file to import. Required.")]
        public System.Byte[] CustomizationFile { get; set; }



        /// <summary>

        /// Gets or sets the path to a file containing the data to upload.

        /// </summary>

        [Parameter(ParameterSetName = "FromFile", Mandatory = true, HelpMessage = "Gets or sets the path to a file containing the data to upload.")]

        [ValidateNotNullOrEmpty]

        public System.String InFile { get; set; }

        /// <summary>
        /// The ID of the Import Job.
        /// </summary>

        [Parameter(HelpMessage = "The ID of the Import Job.")]
        public System.Guid ImportJobId { get; set; }

        /// <summary>
        /// Obsolete. The system will convert unmanaged solution components to managed when you import a managed solution.
        /// </summary>

        [Parameter(HelpMessage = "Obsolete. The system will convert unmanaged solution components to managed when you import a managed solution.")]
        public System.Boolean ConvertToManaged { get; set; }

        /// <summary>
        /// Gets or sets whether enforcement of dependencies related to product updates should be skipped.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets whether enforcement of dependencies related to product updates should be skipped.")]
        public System.Boolean SkipProductUpdateDependencies { get; set; }

        /// <summary>
        /// Gets or sets whether to import the solution as a holding solution staged for upgrade.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets whether to import the solution as a holding solution staged for upgrade.")]
        public System.Boolean HoldingSolution { get; set; }

        /// <summary>
        /// For internal use only.
        /// </summary>

        [Parameter(HelpMessage = "For internal use only.")]
        public System.Boolean SkipQueueRibbonJob { get; set; }

        /// <summary>
        /// For internal use only.
        /// </summary>

        [Parameter(HelpMessage = "For internal use only.")]
        public Microsoft.Xrm.Sdk.LayerDesiredOrder LayerDesiredOrder { get; set; }

        /// <summary>
        /// For internal use only.
        /// </summary>

        [Parameter(HelpMessage = "For internal use only.")]
        public System.Boolean AsyncRibbonProcessing { get; set; }

        /// <summary>
        /// Gets or sets the list of entities to overwrite values from the solution.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets the list of entities to overwrite values from the solution.")]
        public Microsoft.Xrm.Sdk.EntityCollection ComponentParameters { get; set; }

        /// <summary>
        /// Gets or sets additional parameters for the solution.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets additional parameters for the solution.")]
        public Microsoft.Xrm.Sdk.SolutionParameters SolutionParameters { get; set; }

        /// <summary>
        /// Internal use only.
        /// </summary>

        [Parameter(HelpMessage = "Internal use only.")]
        public System.Boolean IsTemplateMode { get; set; }

        /// <summary>
        /// Internal use only.
        /// </summary>

        [Parameter(HelpMessage = "Internal use only.")]
        public System.String TemplateSuffix { get; set; }

        /// <summary>
        /// Gets or sets the TemplateDisplayNamePrefix for the request.
        /// </summary>

        [Parameter(HelpMessage = "Gets or sets the TemplateDisplayNamePrefix for the request.")]
        public System.String TemplateDisplayNamePrefix { get; set; }

                /// <summary>
        /// Processes the cmdlet request and writes the response to the pipeline.
        /// </summary>
        protected override void ProcessRecord()
        {
            base.ProcessRecord();

            var request = new Microsoft.Crm.Sdk.Messages.ImportSolutionAsyncRequest();
                        request.OverwriteUnmanagedCustomizations = OverwriteUnmanagedCustomizations;
            request.PublishWorkflows = PublishWorkflows;
            // Load file if InFile parameter is specified
            byte[] customizationFileData = CustomizationFile;
            if (!string.IsNullOrEmpty(InFile))
            {
                if (!File.Exists(InFile))
                {
                    throw new FileNotFoundException($"The specified file does not exist: {InFile}");
                }
                customizationFileData = File.ReadAllBytes(InFile);
            }
            request.CustomizationFile = customizationFileData;
            request.ImportJobId = ImportJobId;
            request.ConvertToManaged = ConvertToManaged;
            request.SkipProductUpdateDependencies = SkipProductUpdateDependencies;
            request.HoldingSolution = HoldingSolution;
            request.SkipQueueRibbonJob = SkipQueueRibbonJob;
            request.LayerDesiredOrder = LayerDesiredOrder;
            request.AsyncRibbonProcessing = AsyncRibbonProcessing;
            request.ComponentParameters = ComponentParameters;
            request.SolutionParameters = SolutionParameters;
            request.IsTemplateMode = IsTemplateMode;
            request.TemplateSuffix = TemplateSuffix;
            request.TemplateDisplayNamePrefix = TemplateDisplayNamePrefix;

            // Build a short serialized summary of the request for ShouldProcess output
            var requestSummary = new StringBuilder();
            try
            {
                var props = request.GetType().GetProperties(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance);
                foreach (var p in props)
                {
                    object val = null;
                    try { val = p.GetValue(request); } catch { val = null; }
                    var vstr = val == null ? "null" : val.ToString();
                    requestSummary.Append(p.Name).Append("=").Append(vstr).Append("; ");
                }
            }
            catch
            {
                // Ignore any errors while serializing the request for what-if messaging
            }

            // Emit verbose output of the serialized request when -Verbose is used
            try { WriteVerbose(requestSummary.ToString()); } catch { }

            // Support -WhatIf and -Confirm; include request summary in the action description
            if (!ShouldProcess(request.GetType().Name, requestSummary.ToString()))
            {
                return;
            }

            var response = Connection.Execute(request);
            WriteObject(response);
        }
    }
}

#pragma warning restore CS1591
